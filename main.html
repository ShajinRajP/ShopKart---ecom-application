{% load static %}
<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="utf-8">
  <meta content="width=device-width, initial-scale=1.0" name="viewport">

  <title>
    {% block title %} {% endblock title %}
  </title>
  <meta content="ecommerce website for all branded products" name="description">
  <meta content="" name="amazon, flipkart, selling, products">



  <!-- Google Fonts -->
  <link href="https://fonts.googleapis.com/css?family=Open+Sans:300,300i,400,400i,600,600i,700,700i|Nunito:300,300i,400,400i,600,600i,700,700i|Poppins:300,300i,400,400i,500,500i,600,600i,700,700i" rel="stylesheet">

  <!-- Vendor CSS Files -->
  <link href="static/assets/vendor/bootstrap/css/bootstrap.min.css" rel="stylesheet">
  <link href="static/assets/vendor/bootstrap-icons/bootstrap-icons.css" rel="stylesheet">
  <link href="static/assets/vendor/boxicons/css/boxicons.min.css" rel="stylesheet">
  <link href="static/assets/vendor/glightbox/css/glightbox.min.css" rel="stylesheet">
  <link href="static/assets/vendor/remixicon/remixicon.css" rel="stylesheet">
  <link href="static/assets/vendor/swiper/swiper-bundle.min.css" rel="stylesheet">

  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.6.0/css/all.min.css" integrity="sha512-Kc323vGBEqzTmouAECnVceyQqyqdsSiqLQISBL29aUW4U/M7pSPA/gEUZQqv1cwx4OnYxTxve5UMg5GT6L4JJg==" crossorigin="anonymous" referrerpolicy="no-referrer" />
  
  <!-- Template Main CSS File -->
  <link href="static/assets/css/style.css" rel="stylesheet">

  

 
</head>

<body>

  <!-- ======= Header ======= -->
  <header id="header" class="fixed-top bg-dark p-1">
    <div class="container d-flex align-items-center justify-content-between">

      <!--  to use an image logo -->

      <a href="/" class="logo" style="text-decoration: none; color: #ec4427; font-family: Arial, sans-serif; font-size: 24px; font-weight: bold; display: inline-block;">
        <img src="{% static 'images/logos.jpg' %}" class="img-fluid" style="vertical-align: middle; margin-right: 10px;">
        Shop Kart
      </a>

      <nav class="navbar">
        <div class="container-fluid">
        <ul>
          <li><a class="nav-link scrollto active p-1 m-2" href="/">Home</a></li>
          <li><a class="nav-link scrollto p-0 m-2" href="/products">Products</a></li>
          
          
          <li><a class="nav-link scrollto p-0 m-2" href="/profile">My Profile</a></li>
          
          <li><a class="nav-link scrollto p-0 m-2" href="/about">About</a></li>
          
           
          

          {% if request.user.is_authenticated %}

          <li class="dropdown p-1 m-2"><a href=""><span>{{request.user.email|slice:":12"}}...</span> <i class="bi bi-chevron-down"></i></a>
            <ul>
              <li><a class="nav-link scrollto p-1 m-2" href="/auth/logout/">Logout</a></li>
            </ul>
          </li>

          {% else %}
          <li class="dropdown p-1 m-2"><a href=""><span>Sign In</span> <i class="bi bi-chevron-down"></i></a>


            <ul>
              <li><a href="/auth/signup/">Sign Up</a></li>
              <li><a href="/auth/login/">Login</a></li>
              
              
            </ul>
          </li>
          {% endif %}
          
          <li><a class="nav-link scrollto bg-primary p-3 m-2" style="border-radius: 30px"  href="/contact"><i class="fa-solid fa-headphones-simple"></i> </a></li>
          <li>
            <a tabindex="0" role="button" class="nav-link scrollto bg-danger p-1 m-2 text-white" style="border-radius: 60px" id="popcart"
             data-bs-toggle="popcart" title="My Shopping Cart" data-placement="bottom" onclick="updatePopover" data-html="true"><i class="fa-solid fa-cart-shopping"></i>
 
                   (<span id="cart">0</span>)
            </a>
          </li>
        </ul>
        <i class="bi bi-list mobile-nav-toggle"></i>
      </div>
      </nav><!-- .navbar -->

    </div>
  </header><!-- End Header -->

 <div>
 
  {% block content %} {% endblock content %}
    
 </div>

  <main id="main">

    {% block body %}
    
    {% endblock body %}

  </main><!-- End #main -->

  <!-- ======= Footer ======= -->
  <footer id="footer">

    <div class="footer-top">
      <div class="container">
        <div class="row">

          <div class="col-lg-3 col-md-6 footer-contact">
            <h3>Shop Kart</h3>
            <p>
              Nagercoil 629003 <br>
              KK, TamilNadu<br>
              India <br><br>
              <strong>Phone:</strong> +91 8838037254<br>
              <strong>Email:</strong> support@shopkart.com<br>
            </p>
          </div>

          <div class="col-lg-2 col-md-6 footer-links">
            <h4>Useful Links</h4>
            <ul>
              <li><i class="bx bx-chevron-right"></i> <a href="/">Home</a></li>
              <li><i class="bx bx-chevron-right"></i> <a href="/about">About us</a></li>
              <li><i class="bx bx-chevron-right"></i> <a href="/profile">My Orders</a></li>
              <li><i class="bx bx-chevron-right"></i> <a href="#">Terms & Condition</a></li>
              <li><i class="bx bx-chevron-right"></i> <a href="#">Return policy</a></li>
            </ul>
          </div>

          <div class="col-lg-3 col-md-6 footer-links">
            <h4>Popular Searches</h4>
            <ul>
              <li><i class="bx bx-chevron-right"></i> <a href="/products">Cameras</a></li>
              <li><i class="bx bx-chevron-right"></i> <a href="/products">Mobile Phones</a></li>
              <li><i class="bx bx-chevron-right"></i> <a href="/products">Tablets</a></li>
              <li><i class="bx bx-chevron-right"></i> <a href="/products">HeadPhones</a></li>
              <li><i class="bx bx-chevron-right"></i> <a href="/products">Laptops</a></li>
            </ul>
          </div>

          <div class="col-lg-4 col-md-4 footer-newsletter">
            <h4>Follw Us On Social Media</h4>
            <div class="social-links text-center text-md-right pt-3 pt-md-0">
              <a href="#" class="twitter"><i class="bx bxl-twitter"></i></a>
              <a href="#" class="facebook"><i class="bx bxl-facebook"></i></a>
              <a href="#" class="instagram"><i class="bx bxl-instagram"></i></a>
              
              <a href="#" class="linkedin"><i class="bx bxl-linkedin"></i></a>
            </div>
          </div>

        </div>
      </div>
    </div>

    <div class="container d-md-flex py-4">

      <div class="me-md-auto text-center text-md-start">
        <div class="copyright">
          &copy; Copyright <strong><span>ShopKart</span></strong>. All Rights Reserved
        </div>
        
      </div>
      
    </div>
  </footer><!-- End Footer -->

  

  <!-- Vendor JS Files -->
  <script src="static/assets/vendor/bootstrap/js/bootstrap.bundle.min.js"></script>
  <script src="static/assets/vendor/glightbox/js/glightbox.min.js"></script>
  <script src="static/assets/vendor/isotope-layout/isotope.pkgd.min.js"></script>
  <script src="static/assets/vendor/swiper/swiper-bundle.min.js"></script>
  <script src="static/assets/vendor/php-email-form/validate.js"></script>

  <!-- Template Main JS File -->
  <script src="static/assets/js/main.js"></script>
  <script>
    var cart;  // Declare cart variable
  
    if (localStorage.getItem('cart') == null) {
      cart = {};  // Initialize as an empty object
    } else {
      cart = JSON.parse(localStorage.getItem('cart'));
      updateCart(cart);
    }
  
  
  
  
    $('.divpr').on('click', 'button.cart', function() {
      var qty, name, price;
  
      var idstr = this.id.toString();
      console.log(idstr);
  
      if (cart[idstr] !== undefined) {
          qty = cart[idstr][0] + 1;
          cart[idstr][0] = qty;  // Increment quantity for existing items
      } else {
          qty = 1;
          name = document.getElementById('name' + idstr).innerHTML;
          price = document.getElementById('price' + idstr).innerHTML;
          cart[idstr] = [qty, name, price];
      }
  
      updateCart(cart);  // this function updates the cart display
  
      localStorage.setItem('cart', JSON.stringify(cart));
      document.getElementById('cart').innerHTML = Object.keys(cart).length;
      console.log(Object.keys(cart).length);
      document.getElementById("popcart").click();
      location.reload();
    });
  
    updatePopover(cart);
    document.getElementById("popcart").click()
  
    function updateCart(cart) {
      var sum = 0;
  
      for (let item in cart) {
          sum += cart[item][0];
          var itemId = 'div' + item;
          document.getElementById(itemId).innerHTML = "<button id='minus" + item + "' class='btn btn-success btn-sm mt-0 minus'>-</button> <span id='val" + item + "'>" + cart[item][0] + "</span> <button id='plus" + item + "' class='btn btn-success btn-sm mt-0 plus'>+</button>";
          if (cart[item][0] == 0) {
              document.getElementById('div' + item).innerHTML = '<button id="' + item + '" class="btn btn-danger cart btn-sm mt-0">Add to cart</button>';
  
          }
      }
  
      localStorage.setItem('cart', JSON.stringify(cart));
      document.getElementById('cart').innerHTML = sum;
      console.log(cart);
      
      
    }
  
    $('.divpr').on("click", "button.minus", function() {
      var a = this.id.slice(7); // Extract product ID
      cart['pr' + a][0] = Math.max(0, cart['pr' + a][0] - 1); // Ensure quantity is not negative
      document.getElementById('valpr' + a).innerHTML = cart['pr' + a][0];
      updateCart(cart);
      updatePopover(cart);
      location.reload();
      
      
    });
  
    $('.divpr').on("click", "button.plus", function() {
      var a = this.id.slice(6); // Extract product ID
      cart['pr' + a][0] = cart['pr' + a][0] + 1;
      document.getElementById('valpr' + a).innerHTML = cart['pr' + a][0];
      updateCart(cart);
      updatePopover(cart);
      location.reload();
    });
  
    
      // Assuming you have a button with the class 'show-popover-button'
  
  
    
  
  
    function updatePopover(cart) {
      console.log('Updating popover');
  
      var popStr = "<h5>Items in my Shopping Cart</h5><div class='mx-2 my-2'>";
      var i = 1;
  
      for (var item in cart) {
          if (cart[item][0] !== 0) {
              popStr += "<b>" + i + ".</b>";
              popStr += document.getElementById('name' + item).innerHTML.slice(0, 19) + "... " + "<b>" + cart[item][0] + "</b>" + "Qty" + '<br>';
              i++;
          }
      }
  
      popStr += "<div class='my-2'><a href='/checkouts' class='btn btn-success cart btn-sm mt-0' id='checkoutBtn'>Checkout</a> <a class='btn btn-dark cart btn-sm mt-0' id='clearCartBtn' onclick='clearCart()'>Clear Cart</a></div>";
  
      document.getElementById('popcart').setAttribute('data-content', popStr);
  
      // Initialize popover if not already initialized
      if (!$('#popcart').data('bs.popover')) {
          $('#popcart').popover({
              html: true,
              trigger: 'manual'
          });
      }
  
      // Show popover
      $('#popcart').popover('show');
  
      // Attach event handlers
      $('#checkoutBtn').on('click', function () {
          href='/checkouts'
          // Handle checkout logic
          console.log('Checkout button clicked');
      });
  
      // Attach event handler for the clearCart button using class
      $('#clearCartBtn').on('click', function () {
           //Handle clearCart logic
          clearCart();
          console.log('Clear Cart button clicked');
      });
    }

    $('#popcart').on('click', function () {
      //Handle clearCart logic
      updatePopover(cart);
      console.log('Clear Cart button clicked');
 });

  // Close the popover when clicking outside of it
  $(document).on('click', function(e) {
      var $popover = $('#popcart');
      if (!$popover.is(e.target) && $popover.has(e.target).length === 0 && $('.popover').has(e.target).length === 0) {
          $popover.popover('hide');
      }
  });
  
    // Call updatePopover with your cart object
    // updatePopover(cart);
  
  
  
    
    function clearCart() {
      // Retrieve and parse the cart from local storage
      cart = JSON.parse(localStorage.getItem('cart'));
      // Iterate through each item in the cart and update HTML content
      for (var item in cart) {
        document.getElementById('div' + item).innerHTML = '<button id="' + item + '" class="btn btn-danger cart">Add to cart <i class="fa-solid fa-cart-shopping"></i></button>';
      }
  
      // Clear local storage
      localStorage.clear();
  
      // Reset the cart object to an empty object
      cart = {};
  
      // Update the cart display
      updateCart(cart);
  
      // Trigger a click event on the element with the ID 'popcart'
      document.getElementById("popcart").click();
      location.reload();
    }
  
  
    
  </script>
  

</body>

</html>